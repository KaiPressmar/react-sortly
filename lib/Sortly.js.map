{"version":3,"sources":["../src/Sortly.js"],"names":["DEFAULT_TYPE","reduceOffset","noop","Sortly","items","props","draggingDescendants","dragIndex","onDragStart","state","originalItems","descendants","length","forEach","id","setState","didDrop","cancelOnDropOutside","onDragEnd","monitor","change","hoverIndex","offsetX","updateFn","newIndex","threshold","maxDepth","Math","abs","Infinity","some","path","result","newState","onMove","cancelOnDragOutside","dragData","getItem","index","originalIndex","dropIndex","onDrop","onChange","nextProps","isOver","handleEnter","handleLeave","type","Comp","component","itemRenderer","connectDropTarget","map","item","handleDragStart","handleDragEnd","handleMove","handleDrop","Component","PropTypes","string","isRequired","oneOfType","func","arrayOf","shape","array","number","bool","spec","collect","connect","dropTarget","WithDropTarget","defaultProps"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport update from 'immutability-helper';\nimport { DropTarget } from 'react-dnd';\n\nimport { decreaseTreeItem, increaseTreeItem, moveTreeItem, findDescendants } from './utils';\nimport Item from './Item';\n\nconst DEFAULT_TYPE = 'REACT_SORTLY';\nlet reduceOffset = 0;\nconst noop = () => {};\nclass Sortly extends Component {\n  static propTypes = {\n    type: PropTypes.string.isRequired,\n    component: PropTypes.oneOfType([PropTypes.string, PropTypes.func]),\n    items: PropTypes.arrayOf(PropTypes.shape({\n      path: PropTypes.array.isRequired,\n    })).isRequired,\n    itemRenderer: PropTypes.func.isRequired,\n    threshold: PropTypes.number,\n    maxDepth: PropTypes.number,\n    cancelOnDragOutside: PropTypes.bool,\n    cancelOnDropOutside: PropTypes.bool,\n    onMove: PropTypes.func,\n    onDragStart: PropTypes.func,\n    onDragEnd: PropTypes.func,\n    onDrop: PropTypes.func,\n    monitor: PropTypes.shape({\n      getItem: PropTypes.func.isRequired,\n    }).isRequired,\n    isOver: PropTypes.bool.isRequired,\n    connectDropTarget: PropTypes.func.isRequired,\n    onChange: PropTypes.func.isRequired,\n  }\n\n  static defaultProps = {\n    component: 'div',\n    threshold: 20,\n    maxDepth: Infinity,\n    cancelOnDragOutside: false,\n    cancelOnDropOutside: false,\n    onMove: null,\n    onDragStart: noop,\n    onDragEnd: noop,\n    onDrop: noop,\n  }\n\n  state = { items: this.props.items, draggingDescendants: {} }\n\n  componentWillReceiveProps(nextProps) {\n    if (nextProps.items !== this.props.items) {\n      this.setState({ items: nextProps.items });\n    }\n\n    if (nextProps.isOver !== this.props.isOver) {\n      if (nextProps.isOver) {\n        this.handleEnter();\n      } else {\n        this.handleLeave();\n      }\n    }\n  }\n\n  handleDragStart = (dragIndex: number) => {\n    this.props.onDragStart(dragIndex);\n    // Don't allow to drop to it descendants\n    const { items } = this.state;\n    this.originalItems = items;\n\n    const descendants = findDescendants(items, dragIndex);\n\n    if (descendants.length > 0) {\n      const draggingDescendants = {};\n      descendants.forEach(({ id }) => {\n        draggingDescendants[id] = true;\n      });\n\n      this.setState({ draggingDescendants });\n    }\n  }\n\n  handleDragEnd = (dragIndex: number, didDrop: boolean) => {\n    const { cancelOnDropOutside, onDragEnd, monitor } = this.props;\n\n    onDragEnd(dragIndex, didDrop);\n\n    reduceOffset = 0;\n    this.setState({ draggingDescendants: {} });\n    if (cancelOnDropOutside) {\n      if (!monitor.didDrop()) {\n        // restore\n        this.setState({ items: this.originalItems });\n        this.originalItems = null;\n      } else {\n        this.change();\n      }\n    } else {\n      this.change();\n    }\n  }\n\n  handleMove = (dragIndex: number, hoverIndex: number, offsetX: number): number|null => {\n    const { items } = this.state;\n    let updateFn;\n    let newIndex;\n\n    if (dragIndex === hoverIndex) {\n      const { threshold, maxDepth } = this.props;\n\n      // Check that if it move horizontally\n      if (Math.abs(offsetX + reduceOffset) < threshold) {\n        return null;\n      }\n\n      // Move to the right, meaning decrease horizontal level\n      // It now is a child of it previous sibling\n      if (offsetX > 0) {\n        // maxDepth check\n        if (\n          maxDepth < Infinity\n          && [items[dragIndex], ...findDescendants(items, dragIndex)].some(({ path }) => path.length >= maxDepth)\n        ) {\n          return null;\n        }\n\n        updateFn = decreaseTreeItem(items, dragIndex);\n        if (!updateFn) {\n          return null;\n        }\n        reduceOffset -= threshold;\n      } else { // Move to the left, meaning increase horizontal level\n        updateFn = increaseTreeItem(items, dragIndex);\n        if (!updateFn) {\n          return null;\n        }\n        reduceOffset += threshold;\n      }\n\n      newIndex = hoverIndex;\n    } else {\n      const result = moveTreeItem(items, dragIndex, hoverIndex);\n      updateFn = result.updateFn; // eslint-disable-line prefer-destructuring\n      newIndex = result.newIndex; // eslint-disable-line prefer-destructuring\n    }\n\n    const newState = update(this.state, {\n      items: updateFn,\n    });\n\n    if (this.props.onMove) {\n      const result = this.props.onMove(newState.items, dragIndex, newIndex);\n\n      if (!result) {\n        return null;\n      }\n\n      if (result !== true) {\n        newState.items = result;\n      }\n    }\n\n    this.setState(newState);\n\n    return newIndex;\n  }\n\n  handleEnter = () => {\n\n  }\n\n  handleLeave = () => {\n    const { cancelOnDragOutside, monitor } = this.props;\n\n    if (cancelOnDragOutside && !monitor.didDrop()) {\n      const dragData = monitor.getItem();\n      dragData.index = dragData.originalIndex;\n      this.setState({ items: this.originalItems });\n    }\n  }\n\n  handleDrop = (dragIndex: number, dropIndex: number) => {\n    this.props.onDrop(dragIndex, dropIndex);\n  }\n\n  change = () => {\n    this.props.onChange(this.state.items);\n  }\n\n  render() {\n    const { type, component: Comp, itemRenderer, connectDropTarget } = this.props;\n    const { items, draggingDescendants } = this.state;\n\n    return connectDropTarget(\n      <Comp>\n        {items.map((item, index) => (\n          <Item\n            {...item}\n            key={item.id}\n            __dndType={type}\n            index={index}\n            renderer={itemRenderer}\n            isClosestDragging={draggingDescendants[item.id] === true}\n            onDragStart={this.handleDragStart}\n            onDragEnd={this.handleDragEnd}\n            onMove={this.handleMove}\n            onDrop={this.handleDrop}\n          />\n        ))}\n      </Comp>,\n    );\n  }\n}\n\nconst spec = {\n\n};\n\nconst collect = (connect, monitor) => ({\n  monitor,\n  isOver: monitor.isOver(),\n  connectDropTarget: connect.dropTarget(),\n});\n\nconst WithDropTarget = DropTarget(props => props.type, spec, collect)(Sortly);\nWithDropTarget.defaultProps = {\n  type: DEFAULT_TYPE,\n};\n\nexport default WithDropTarget;\n"],"file":"Sortly.js"}